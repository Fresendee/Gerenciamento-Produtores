<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${produtor.id} == null ? 'Novo Produtor' : 'Editar Produtor'">Cadastro de Produtor</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="dashboard-layout">
    <!-- Sidebar (Menu de Navegação Fixo e Global) -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>
                <span class="material-icons-round" style="color: var(--accent-yellow);">agriculture</span>
                NPA
            </h1>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="/">
                        <span class="material-icons-round">dashboard</span>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="/produtores" class="active">
                        <span class="material-icons-round">group</span>
                        Produtores
                    </a>
                </li>
                <li>
                    <a href="/atividades">
                        <span class="material-icons-round">grass</span>
                        Atividades
                    </a>
                </li>
                <li>
                    <a href="/visitas">
                        <span class="material-icons-round">assignment</span>
                        Visitas Técnicas
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Conteúdo Principal -->
    <div class="main-content">
        <div class="container">
            <!-- Cabeçalho da Página -->
            <div class="page-header">
                <div>
                    <div class="breadcrumb">
                        <a href="/">
                            <span class="material-icons-round">home</span>
                            Início
                        </a>
                        <span class="material-icons-round">chevron_right</span>
                        <a href="/produtores">Produtores</a>
                        <span class="material-icons-round">chevron_right</span>
                        <span th:text="${produtor.id} == null ? 'Novo' : 'Editar'">Novo</span>
                    </div>
                    <h1>
                        <span class="material-icons-round" style="color: var(--primary-green);">person_add</span>
                        <span th:text="${produtor.id} == null ? 'Novo Produtor Rural' : 'Editar Produtor Rural'">Cadastro de Produtor</span>
                    </h1>
                </div>
            </div>

            <!-- Barra de Ações -->
            <div class="action-bar">
                <a href="/produtores" class="btn btn-secondary">
                    <span class="material-icons-round">arrow_back</span>
                    Voltar para Lista
                </a>
            </div>

            <!-- Formulário -->
            <form th:action="@{/produtores/salvar}" th:object="${produtor}" method="post" id="formProdutor">
                <input type="hidden" th:field="*{id}"/>

                <!-- Seção: Dados Pessoais -->
                <div class="form-section">
                    <div class="form-section-header">
                        <span class="material-icons-round">badge</span>
                        <h3>Dados Pessoais</h3>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                Nome Completo
                                <span class="required">*</span>
                            </label>
                            <input type="text"
                                   th:field="*{nome}"
                                   required
                                   placeholder="Digite o nome completo do produtor"
                                   autocomplete="name"/>
                            <span class="helper-text">Nome completo sem abreviações</span>
                        </div>

                        <div class="form-group">
                            <label>
                                CPF
                                <span class="required">*</span>
                            </label>
                            <input type="text"
                                   th:field="*{cpf}"
                                   required
                                   placeholder="000.000.000-00"
                                   maxlength="14"
                                   id="cpf"/>
                            <span class="helper-text">Apenas números ou formatado</span>
                        </div>

                        <div class="form-group">
                            <label>
                                Telefone
                            </label>
                            <input type="tel"
                                   th:field="*{telefone}"
                                   placeholder="(00) 00000-0000"
                                   maxlength="15"
                                   id="telefone"/>
                            <span class="helper-text">Telefone para contato</span>
                        </div>
                    </div>
                </div>

                <!-- Seção: Dados da Propriedade -->
                <div class="form-section">
                    <div class="form-section-header">
                        <span class="material-icons-round">landscape</span>
                        <h3>Dados da Propriedade</h3>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                Localização
                            </label>
                            <input type="text"
                                   th:field="*{localizacao}"
                                   placeholder="Ex: Araguari/MG"
                                   autocomplete="address-level2"/>
                            <span class="helper-text">Cidade e estado da propriedade</span>
                        </div>

                        <div class="form-group">
                            <label>
                                Inscrição Produtor Rural
                            </label>
                            <input type="text"
                                   th:field="*{inscricaoProdutorRural}"
                                   placeholder="Número da inscrição"/>
                            <span class="helper-text">Inscrição estadual do produtor</span>
                        </div>

                        <div class="form-group">
                            <label>
                                Tamanho da Propriedade (hectares)
                            </label>
                            <input type="number"
                                   step="0.01"
                                   min="0"
                                   th:field="*{tamanhoPropriedade}"
                                   placeholder="0.00"/>
                            <span class="helper-text">Área total em hectares</span>
                        </div>
                    </div>
                </div>

                <!-- Seção: Dados Familiares -->
                <div class="form-section">
                    <div class="form-section-header">
                        <span class="material-icons-round">family_restroom</span>
                        <h3>Dados Familiares</h3>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                Número de Pessoas na Família
                            </label>
                            <input type="number"
                                   min="0"
                                   th:field="*{numeroPessoasFamilia}"
                                   placeholder="0"/>
                            <span class="helper-text">Total de pessoas que residem na propriedade</span>
                        </div>
                    </div>
                </div>

                <!-- Alerta de Campos Obrigatórios -->
                <div class="alert alert-warning mt-24">
                    <span class="material-icons-round">info</span>
                    <span>Campos marcados com <strong>*</strong> são obrigatórios</span>
                </div>

                <!-- Botões de Ação -->
                <div class="action-bar" style="justify-content: center; margin-top: 32px;">
                    <button type="submit" class="btn btn-lg" id="btnSalvar">
                        <span class="material-icons-round">save</span>
                        Salvar Produtor
                    </button>
                    <a href="/produtores" class="btn btn-secondary btn-lg">
                        <span class="material-icons-round">close</span>
                        Cancelar
                    </a>
                </div>
            </form>

            <!-- Informações Adicionais -->
            <div class="info-box mt-24">
                <div class="info-box-header">
                    <span class="material-icons-round">tips_and_updates</span>
                    <h4>Dica</h4>
                </div>
                <p>
                    Após salvar o produtor, você poderá adicionar atividades agrícolas e registrar
                    visitas técnicas diretamente através da lista de produtores, usando os atalhos
                    disponíveis na coluna de ações.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Script para Máscaras e Validações (Mantido) -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Máscara para CPF
        const cpfInput = document.getElementById('cpf');
        if (cpfInput) {
            cpfInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 11) value = value.slice(0, 11);

                if (value.length > 9) {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                } else if (value.length > 6) {
                    value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
                } else if (value.length > 3) {
                    value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
                }

                e.target.value = value;
            });
        }

        // Máscara para Telefone
        const telefoneInput = document.getElementById('telefone');
        if (telefoneInput) {
            telefoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 11) value = value.slice(0, 11);

                if (value.length > 10) {
                    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                } else if (value.length > 6) {
                    value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
                } else if (value.length > 2) {
                    value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
                }

                e.target.value = value;
            });
        }

        // Validação do formulário
        const form = document.getElementById('formProdutor');
        form.addEventListener('submit', function(e) {
            const cpf = cpfInput.value.replace(/\D/g, '');
            if (cpf && cpf.length !== 11) {
                e.preventDefault();
                alert('CPF inválido! Digite um CPF com 11 dígitos.');
                cpfInput.focus();
                return false;
            }

            // Feedback visual
            const btnSalvar = document.getElementById('btnSalvar');
            btnSalvar.innerHTML = '<span class="material-icons-round">hourglass_empty</span> Salvando...';
            btnSalvar.disabled = true;
        });

        // Animação suave nos campos (Removida)
        // const campos = document.querySelectorAll('input, select, textarea');
        // campos.forEach((campo, index) => {
        //     campo.style.opacity = '0';
        //     campo.style.transform = 'translateY(10px)';
        //     setTimeout(() => {
        //         campo.style.transition = 'all 0.3s ease';
        //         campo.style.opacity = '1';
        //         campo.style.transform = 'translateY(0)';
        //     }, index * 20);
        // });
    });
</script>
</body>
</html>
